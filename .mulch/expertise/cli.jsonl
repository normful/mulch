{"type":"pattern","name":"init-artifacts","description":"mulch init creates .mulch/, config, .gitattributes (merge=union for JSONL), and .mulch/README.md — modeled after Beads' bd init pattern","classification":"foundational","recorded_at":"2026-02-10T00:33:16.583Z","files":["src/utils/config.ts"],"id":"mx-6e8404"}
{"type":"pattern","name":"git-hook-markers","description":"Git hooks use # mulch:start / # mulch:end markers for safe append/remove in .git/hooks/pre-commit, same marker pattern as HTML comments in AGENTS.md sections","classification":"tactical","recorded_at":"2026-02-10T00:33:18.159Z","files":["src/commands/setup.ts"],"id":"mx-a27124"}
{"type":"pattern","name":"idempotent-init","description":"initMulchDir uses existsSync guards for config and README so re-running init fills missing artifacts without overwriting user customizations","classification":"tactical","recorded_at":"2026-02-10T00:35:37.172Z","files":["src/utils/config.ts","src/commands/init.ts"],"id":"mx-7b4d0e"}
{"type":"pattern","name":"edit-by-index","description":"mulch edit uses 1-based JSONL line indices to identify records. Reads all records, mutates the target, validates with Ajv, then rewrites the whole file via writeExpertiseFile.","classification":"tactical","recorded_at":"2026-02-10T00:40:55.350Z","files":["src/commands/edit.ts"],"id":"mx-2217e9"}
{"type":"pattern","name":"commander-optional-arg-with-options","description":"When Commander has both a positional [arg] and options, the action callback receives (arg, options) — positional first, options second. See mulch prime implementation.","classification":"tactical","recorded_at":"2026-02-10T00:55:05.476Z","files":["src/commands/prime.ts"],"id":"mx-be5723"}
{"type":"pattern","name":"search-brute-force","description":"mulch search does case-insensitive substring match across all string-valued fields via Object.values(). No index needed for <1000 records. Filters: --domain, --type.","classification":"tactical","recorded_at":"2026-02-10T01:09:20.659Z","files":["src/commands/search.ts","src/utils/expertise.ts"],"id":"mx-7e7c0f"}
{"type":"pattern","name":"record-dedup","description":"mulch record checks for duplicates before appending. Named types (pattern/decision) upsert by name/title. Unnamed types (convention/failure) skip on exact content/description match. --force overrides.","classification":"tactical","recorded_at":"2026-02-10T01:09:21.633Z","files":["src/commands/record.ts","src/utils/expertise.ts"],"id":"mx-d065b4"}
{"type":"reference","name":"cli-entry","description":"Main CLI entry point","classification":"tactical","recorded_at":"2026-02-10T01:16:20.884Z","files":["src/cli.ts"],"id":"mx-c5a8bf"}
{"type":"guide","name":"add-command","description":"How to add a new CLI command: create src/commands/<name>.ts, export register<Name>Command, register in src/cli.ts","classification":"tactical","recorded_at":"2026-02-10T01:16:26.826Z","id":"mx-60f9f9"}
{"type":"pattern","name":"variadic-commander-args","description":"Commander.js [args...] creates a string[] parameter. Combine with --option <vals...> by merging arrays and deduplicating with new Set(). Action callback receives (string[], options).","classification":"tactical","recorded_at":"2026-02-10T01:16:55.126Z","files":["src/commands/prime.ts"],"id":"mx-1ac693"}
{"type":"pattern","name":"type-extensible-records","description":"Adding record types follows a checklist: (1) record.ts types, (2) record-schema.ts oneOf, (3) record.ts command switch, (4) edit.ts switch, (5) expertise.ts findDuplicate, (6) format.ts formatters (md/xml/plain), (7) search.ts choices. Named types (pattern/decision/reference/guide) upsert by name; unnamed (convention/failure) skip on exact match.","classification":"tactical","recorded_at":"2026-02-10T01:16:58.885Z","files":["src/schemas/record.ts","src/schemas/record-schema.ts","src/commands/record.ts","src/utils/format.ts"],"id":"mx-65226a"}
{"type":"pattern","name":"compact-prime-format","description":"mulch prime --compact outputs flat one-liner-per-record list with [type] tags, no ### section headers, no recording instructions footer. Compact wrapper omits the Recording New Learnings section.","classification":"tactical","recorded_at":"2026-02-10T01:25:46.444Z","files":["src/utils/format.ts","src/commands/prime.ts"],"id":"mx-dea138"}
{"type":"pattern","name":"tags-on-records","description":"Optional tags: string[] on all record types via BaseRecord. --tags flag on record (comma-separated), --tag filter on search (exact match, case-insensitive). searchRecords also searches array values via Array.isArray check.","classification":"tactical","recorded_at":"2026-02-10T01:26:13.157Z","files":["src/schemas/record.ts","src/commands/record.ts","src/commands/search.ts","src/utils/expertise.ts"],"id":"mx-6bdf1e"}
{"type":"pattern","name":"delete-command","description":"mulch delete <domain> <identifier> removes a record by mx-ID or 1-based index. Same identifier resolution pattern as edit. Splices from array, rewrites JSONL via writeExpertiseFile.","classification":"tactical","recorded_at":"2026-02-10T18:42:26.815Z","files":["src/commands/delete.ts"],"id":"mx-75ef3e"}
{"type":"pattern","name":"context-aware-prime","description":"mulch prime --context filters records by git changed files. Records without files field (conventions, failures, decisions, guides) always pass. Pattern/reference records filtered by file-path intersection using suffix matching. filterByContext and fileMatchesAny live in src/utils/git.ts as shared utilities.","classification":"tactical","recorded_at":"2026-02-10T18:51:23.100Z","files":["src/commands/prime.ts","src/utils/git.ts"],"id":"mx-004b07"}
{"type":"pattern","name":"shared-git-utils","description":"isGitRepo, getChangedFiles, fileMatchesAny, filterByContext extracted to src/utils/git.ts as shared utilities used by both learn and prime commands. Avoids duplicating git diff logic.","classification":"tactical","recorded_at":"2026-02-10T18:51:24.961Z","files":["src/utils/git.ts","src/commands/learn.ts","src/commands/prime.ts"],"id":"mx-0622d4"}
{"type":"pattern","name":"record-linking","description":"relates_to and supersedes optional string[] fields on BaseRecord. Schema validates mx-ID pattern. formatLinks() helper renders in all prime formats (md, compact, xml, plain). Links shown even without --full flag.","classification":"foundational","recorded_at":"2026-02-10T18:58:45.777Z","files":["src/schemas/record.ts","src/schemas/record-schema.ts","src/utils/format.ts"],"id":"mx-775d76"}
{"type":"pattern","name":"compact-command","description":"mulch compact --analyze finds candidates (3+ records of same type, or 2+ with stale records). --apply takes --records (IDs/indices), type-specific fields, removes source records, appends consolidated record with foundational classification and supersedes links.","classification":"foundational","recorded_at":"2026-02-10T18:58:51.077Z","files":["src/commands/compact.ts"],"id":"mx-d80a97"}
{"type":"pattern","name":"compact-default-prime","description":"mulch prime defaults to compact output. Use -v/--verbose for full output with section headers, rules, and recording instructions. --format xml|plain bypass compact and use their own formatters. --full only takes effect with --verbose.","classification":"tactical","recorded_at":"2026-02-10T19:01:26.869Z","files":["src/commands/prime.ts"],"id":"mx-0b1448"}
